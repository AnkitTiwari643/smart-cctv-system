{% extends "base.html" %}

{% block title %}System Monitor - Smart CCTV System{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col">
        <h1 class="display-6 mb-0">
            <i class="bi bi-graph-up text-primary"></i> 
            System Monitor
        </h1>
        <p class="text-muted">Real-time system performance and health monitoring</p>
    </div>
    <div class="col-auto">
        <button class="btn btn-outline-primary" onclick="exportSystemReport()">
            <i class="bi bi-download"></i> Export Report
        </button>
        <button class="btn btn-outline-secondary" onclick="refreshSystemData()">
            <i class="bi bi-arrow-clockwise"></i> Refresh
        </button>
    </div>
</div>

<!-- System Status Overview -->
<div class="row mb-4">
    <div class="col-lg-3 col-md-6 mb-3">
        <div class="card bg-success text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="card-title mb-0">System Status</h6>
                        <h4 class="mb-0" id="systemStatus">Running</h4>
                    </div>
                    <i class="bi bi-shield-check display-6 opacity-75"></i>
                </div>
                <div class="mt-2">
                    <small>Uptime: <span id="systemUptime">2d 14h 32m</span></small>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-3 col-md-6 mb-3">
        <div class="card bg-info text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="card-title mb-0">CPU Usage</h6>
                        <h4 class="mb-0"><span id="cpuUsage">34</span>%</h4>
                    </div>
                    <i class="bi bi-cpu display-6 opacity-75"></i>
                </div>
                <div class="mt-2">
                    <div class="progress" style="height: 4px;">
                        <div class="progress-bar bg-white" id="cpuProgressBar" style="width: 34%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-3 col-md-6 mb-3">
        <div class="card bg-warning text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="card-title mb-0">Memory</h6>
                        <h4 class="mb-0"><span id="memoryUsage">67</span>%</h4>
                    </div>
                    <i class="bi bi-memory display-6 opacity-75"></i>
                </div>
                <div class="mt-2">
                    <small><span id="memoryDetails">5.4 GB / 8.0 GB</span></small>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-3 col-md-6 mb-3">
        <div class="card bg-primary text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="card-title mb-0">Disk Space</h6>
                        <h4 class="mb-0"><span id="diskUsage">42</span>%</h4>
                    </div>
                    <i class="bi bi-hdd display-6 opacity-75"></i>
                </div>
                <div class="mt-2">
                    <small><span id="diskDetails">84 GB / 200 GB</span></small>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Performance Charts -->
<div class="row mb-4">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="bi bi-graph-up text-primary me-2"></i>
                    Performance Metrics
                </h5>
                <div class="btn-group btn-group-sm" role="group">
                    <input type="radio" class="btn-check" name="timeRange" id="range1h" autocomplete="off" checked>
                    <label class="btn btn-outline-primary" for="range1h">1H</label>
                    
                    <input type="radio" class="btn-check" name="timeRange" id="range6h" autocomplete="off">
                    <label class="btn btn-outline-primary" for="range6h">6H</label>
                    
                    <input type="radio" class="btn-check" name="timeRange" id="range24h" autocomplete="off">
                    <label class="btn btn-outline-primary" for="range24h">24H</label>
                </div>
            </div>
            <div class="card-body">
                <canvas id="performanceChart" width="400" height="200"></canvas>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <div class="card h-100">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-thermometer-half text-danger me-2"></i>
                    Temperature
                </h5>
            </div>
            <div class="card-body d-flex flex-column justify-content-center">
                <div class="text-center">
                    <canvas id="temperatureGauge" width="200" height="200"></canvas>
                    <div class="mt-3">
                        <h3 class="mb-0" id="temperatureValue">58°C</h3>
                        <small class="text-muted">CPU Temperature</small>
                    </div>
                </div>
                
                <div class="mt-4">
                    <div class="d-flex justify-content-between mb-2">
                        <span class="text-muted">GPU:</span>
                        <span id="gpuTemp">45°C</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span class="text-muted">System:</span>
                        <span id="systemTemp">42°C</span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span class="text-muted">Fan Speed:</span>
                        <span id="fanSpeed">2,340 RPM</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Process Information and Logs -->
<div class="row mb-4">
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="bi bi-list-task text-success me-2"></i>
                    Running Processes
                </h5>
                <button class="btn btn-sm btn-outline-secondary" onclick="refreshProcesses()">
                    <i class="bi bi-arrow-clockwise"></i>
                </button>
            </div>
            <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                <div class="table-responsive">
                    <table class="table table-sm table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>Process</th>
                                <th>CPU %</th>
                                <th>Memory</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="processTable">
                            <tr>
                                <td>
                                    <strong>main.py</strong><br>
                                    <small class="text-muted">CCTV Main Process</small>
                                </td>
                                <td><span class="badge bg-success">15.2%</span></td>
                                <td>1.2 GB</td>
                                <td><span class="badge bg-success">Running</span></td>
                            </tr>
                            <tr>
                                <td>
                                    <strong>object_detector.py</strong><br>
                                    <small class="text-muted">AI Detection</small>
                                </td>
                                <td><span class="badge bg-warning">8.7%</span></td>
                                <td>2.1 GB</td>
                                <td><span class="badge bg-success">Running</span></td>
                            </tr>
                            <tr>
                                <td>
                                    <strong>camera_manager.py</strong><br>
                                    <small class="text-muted">Camera Interface</small>
                                </td>
                                <td><span class="badge bg-info">3.4%</span></td>
                                <td>512 MB</td>
                                <td><span class="badge bg-success">Running</span></td>
                            </tr>
                            <tr>
                                <td>
                                    <strong>web_interface.py</strong><br>
                                    <small class="text-muted">Web Server</small>
                                </td>
                                <td><span class="badge bg-info">2.1%</span></td>
                                <td>256 MB</td>
                                <td><span class="badge bg-success">Running</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="bi bi-terminal text-info me-2"></i>
                    System Logs
                </h5>
                <div class="btn-group btn-group-sm">
                    <button class="btn btn-outline-secondary" onclick="clearLogs()">
                        <i class="bi bi-trash"></i> Clear
                    </button>
                    <button class="btn btn-outline-secondary" onclick="downloadLogs()">
                        <i class="bi bi-download"></i> Download
                    </button>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="log-container" style="height: 400px; overflow-y: auto; font-family: 'Courier New', monospace; font-size: 0.875rem;">
                    <div id="logContent" class="p-3">
                        <div class="log-entry">
                            <span class="text-muted">[2024-01-15 14:32:15]</span> 
                            <span class="text-success">[INFO]</span> 
                            System startup completed successfully
                        </div>
                        <div class="log-entry">
                            <span class="text-muted">[2024-01-15 14:32:16]</span> 
                            <span class="text-info">[DEBUG]</span> 
                            Camera #1 initialized: Front Door
                        </div>
                        <div class="log-entry">
                            <span class="text-muted">[2024-01-15 14:32:17]</span> 
                            <span class="text-info">[DEBUG]</span> 
                            Camera #2 initialized: Back Yard
                        </div>
                        <div class="log-entry">
                            <span class="text-muted">[2024-01-15 14:32:18]</span> 
                            <span class="text-success">[INFO]</span> 
                            Object detection module loaded
                        </div>
                        <div class="log-entry">
                            <span class="text-muted">[2024-01-15 14:32:20]</span> 
                            <span class="text-warning">[WARN]</span> 
                            High CPU usage detected: 89%
                        </div>
                        <div class="log-entry">
                            <span class="text-muted">[2024-01-15 14:33:45]</span> 
                            <span class="text-success">[INFO]</span> 
                            Motion detected: Camera #1
                        </div>
                        <div class="log-entry">
                            <span class="text-muted">[2024-01-15 14:34:12]</span> 
                            <span class="text-primary">[ALERT]</span> 
                            Person detected: Back Yard (Confidence: 94%)
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Network and Storage -->
<div class="row">
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-wifi text-primary me-2"></i>
                    Network Activity
                </h5>
            </div>
            <div class="card-body">
                <canvas id="networkChart" width="400" height="200"></canvas>
                
                <div class="row mt-3">
                    <div class="col-6 text-center">
                        <h6 class="text-success">Download</h6>
                        <h4 id="downloadSpeed">2.4 MB/s</h4>
                    </div>
                    <div class="col-6 text-center">
                        <h6 class="text-danger">Upload</h6>
                        <h4 id="uploadSpeed">1.1 MB/s</h4>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-hdd-stack text-warning me-2"></i>
                    Storage Usage
                </h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <div class="d-flex justify-content-between mb-2">
                        <span>System Drive (/):</span>
                        <span>84 GB / 200 GB</span>
                    </div>
                    <div class="progress">
                        <div class="progress-bar bg-primary" style="width: 42%"></div>
                    </div>
                </div>
                
                <div class="mb-3">
                    <div class="d-flex justify-content-between mb-2">
                        <span>Recordings (/data):</span>
                        <span>156 GB / 500 GB</span>
                    </div>
                    <div class="progress">
                        <div class="progress-bar bg-warning" style="width: 31%"></div>
                    </div>
                </div>
                
                <div class="mb-3">
                    <div class="d-flex justify-content-between mb-2">
                        <span>Snapshots:</span>
                        <span>12 GB / 50 GB</span>
                    </div>
                    <div class="progress">
                        <div class="progress-bar bg-success" style="width: 24%"></div>
                    </div>
                </div>
                
                <div class="alert alert-info mb-0">
                    <small>
                        <i class="bi bi-info-circle me-1"></i>
                        Auto-cleanup enabled for recordings older than 30 days
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    let performanceChart, networkChart, temperatureGauge;
    let systemStatsInterval;
    
    document.addEventListener('DOMContentLoaded', function() {
        initializeCharts();
        startRealTimeUpdates();
        setupTimeRangeButtons();
    });
    
    function initializeCharts() {
        // Performance Chart
        const perfCtx = document.getElementById('performanceChart').getContext('2d');
        performanceChart = new Chart(perfCtx, {
            type: 'line',
            data: {
                labels: generateTimeLabels(60), // Last 60 minutes
                datasets: [
                    {
                        label: 'CPU %',
                        data: generateRandomData(60, 20, 80),
                        borderColor: '#0d6efd',
                        backgroundColor: 'rgba(13, 110, 253, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: 'Memory %',
                        data: generateRandomData(60, 40, 90),
                        borderColor: '#ffc107',
                        backgroundColor: 'rgba(255, 193, 7, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: 'Disk I/O %',
                        data: generateRandomData(60, 10, 60),
                        borderColor: '#20c997',
                        backgroundColor: 'rgba(32, 201, 151, 0.1)',
                        tension: 0.4
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: {
                            color: '#fff'
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        ticks: {
                            color: '#6c757d',
                            callback: function(value) {
                                return value + '%';
                            }
                        },
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        }
                    },
                    x: {
                        ticks: {
                            color: '#6c757d'
                        },
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        }
                    }
                }
            }
        });
        
        // Network Chart
        const netCtx = document.getElementById('networkChart').getContext('2d');
        networkChart = new Chart(netCtx, {
            type: 'line',
            data: {
                labels: generateTimeLabels(30),
                datasets: [
                    {
                        label: 'Download (MB/s)',
                        data: generateRandomData(30, 0.5, 5),
                        borderColor: '#28a745',
                        backgroundColor: 'rgba(40, 167, 69, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: 'Upload (MB/s)',
                        data: generateRandomData(30, 0.2, 2),
                        borderColor: '#dc3545',
                        backgroundColor: 'rgba(220, 53, 69, 0.1)',
                        tension: 0.4
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: {
                            color: '#fff'
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            color: '#6c757d',
                            callback: function(value) {
                                return value.toFixed(1) + ' MB/s';
                            }
                        },
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        }
                    },
                    x: {
                        ticks: {
                            color: '#6c757d'
                        },
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        }
                    }
                }
            }
        });
        
        // Temperature Gauge
        initializeTemperatureGauge();
    }
    
    function initializeTemperatureGauge() {
        const canvas = document.getElementById('temperatureGauge');
        const ctx = canvas.getContext('2d');
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const radius = 80;
        
        function drawGauge(temperature) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Background circle
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
            ctx.strokeStyle = '#495057';
            ctx.lineWidth = 8;
            ctx.stroke();
            
            // Temperature arc
            const startAngle = -Math.PI / 2;
            const endAngle = startAngle + (temperature / 100) * 2 * Math.PI;
            
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, startAngle, endAngle);
            
            // Color based on temperature
            if (temperature < 50) {
                ctx.strokeStyle = '#28a745'; // Green
            } else if (temperature < 70) {
                ctx.strokeStyle = '#ffc107'; // Yellow
            } else {
                ctx.strokeStyle = '#dc3545'; // Red
            }
            
            ctx.lineWidth = 8;
            ctx.lineCap = 'round';
            ctx.stroke();
            
            // Center dot
            ctx.beginPath();
            ctx.arc(centerX, centerY, 8, 0, 2 * Math.PI);
            ctx.fillStyle = '#fff';
            ctx.fill();
        }
        
        temperatureGauge = { draw: drawGauge };
        drawGauge(58); // Initial temperature
    }
    
    function generateTimeLabels(count) {
        const labels = [];
        const now = new Date();
        for (let i = count - 1; i >= 0; i--) {
            const time = new Date(now.getTime() - i * 60000); // 1 minute intervals
            labels.push(time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }));
        }
        return labels;
    }
    
    function generateRandomData(count, min, max) {
        const data = [];
        for (let i = 0; i < count; i++) {
            data.push(Math.random() * (max - min) + min);
        }
        return data;
    }
    
    function startRealTimeUpdates() {
        systemStatsInterval = setInterval(updateSystemStats, 2000);
    }
    
    function updateSystemStats() {
        // Update system metrics
        const cpuUsage = Math.floor(Math.random() * 30) + 20; // 20-50%
        const memoryUsage = Math.floor(Math.random() * 20) + 60; // 60-80%
        const diskUsage = Math.floor(Math.random() * 10) + 40; // 40-50%
        const temperature = Math.floor(Math.random() * 20) + 50; // 50-70°C
        
        // Update UI elements
        document.getElementById('cpuUsage').textContent = cpuUsage;
        document.getElementById('cpuProgressBar').style.width = cpuUsage + '%';
        document.getElementById('memoryUsage').textContent = memoryUsage;
        document.getElementById('diskUsage').textContent = diskUsage;
        document.getElementById('temperatureValue').textContent = temperature + '°C';
        
        // Update temperature gauge
        if (temperatureGauge) {
            temperatureGauge.draw(temperature);
        }
        
        // Update network speeds
        const downloadSpeed = (Math.random() * 3 + 1).toFixed(1);
        const uploadSpeed = (Math.random() * 1.5 + 0.5).toFixed(1);
        document.getElementById('downloadSpeed').textContent = downloadSpeed + ' MB/s';
        document.getElementById('uploadSpeed').textContent = uploadSpeed + ' MB/s';
        
        // Update charts with new data
        updateChartData(performanceChart, [cpuUsage, memoryUsage, Math.random() * 50 + 10]);
        updateChartData(networkChart, [parseFloat(downloadSpeed), parseFloat(uploadSpeed)]);
        
        // Add new log entry occasionally
        if (Math.random() < 0.3) {
            addLogEntry();
        }
    }
    
    function updateChartData(chart, newData) {
        chart.data.labels.shift();
        chart.data.labels.push(new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }));
        
        chart.data.datasets.forEach((dataset, index) => {
            dataset.data.shift();
            dataset.data.push(newData[index]);
        });
        
        chart.update('none');
    }
    
    function addLogEntry() {
        const logContent = document.getElementById('logContent');
        const now = new Date();
        const timestamp = now.toISOString().slice(0, 19).replace('T', ' ');
        
        const logTypes = ['INFO', 'DEBUG', 'WARN', 'ERROR', 'ALERT'];
        const logMessages = [
            'Camera health check completed',
            'Motion detected in zone 2',
            'Object detection confidence: 87%',
            'Memory cleanup performed',
            'Alert notification sent',
            'Person identified: Unknown',
            'Recording started for camera #3'
        ];
        
        const logType = logTypes[Math.floor(Math.random() * logTypes.length)];
        const message = logMessages[Math.floor(Math.random() * logMessages.length)];
        
        const logClasses = {
            'INFO': 'text-success',
            'DEBUG': 'text-info',
            'WARN': 'text-warning',
            'ERROR': 'text-danger',
            'ALERT': 'text-primary'
        };
        
        const newEntry = document.createElement('div');
        newEntry.className = 'log-entry';
        newEntry.innerHTML = `
            <span class="text-muted">[${timestamp}]</span> 
            <span class="${logClasses[logType]}">[${logType}]</span> 
            ${message}
        `;
        
        logContent.appendChild(newEntry);
        
        // Keep only last 50 entries
        const entries = logContent.querySelectorAll('.log-entry');
        if (entries.length > 50) {
            entries[0].remove();
        }
        
        // Auto-scroll to bottom
        logContent.scrollTop = logContent.scrollHeight;
    }
    
    function setupTimeRangeButtons() {
        document.querySelectorAll('input[name="timeRange"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const range = this.id.replace('range', '');
                updateChartTimeRange(range);
            });
        });
    }
    
    function updateChartTimeRange(range) {
        let dataPoints;
        switch(range) {
            case '1h': dataPoints = 60; break;
            case '6h': dataPoints = 360; break;
            case '24h': dataPoints = 1440; break;
            default: dataPoints = 60;
        }
        
        // Regenerate chart data for the selected time range
        performanceChart.data.labels = generateTimeLabels(dataPoints);
        performanceChart.data.datasets[0].data = generateRandomData(dataPoints, 20, 80);
        performanceChart.data.datasets[1].data = generateRandomData(dataPoints, 40, 90);
        performanceChart.data.datasets[2].data = generateRandomData(dataPoints, 10, 60);
        performanceChart.update();
        
        showNotification('Info', `Chart updated to show ${range} range`, 'info');
    }
    
    function refreshSystemData() {
        showNotification('Info', 'Refreshing system data...', 'info');
        
        // Force immediate update
        updateSystemStats();
        
        setTimeout(() => {
            showNotification('Success', 'System data refreshed', 'success');
        }, 1000);
    }
    
    function refreshProcesses() {
        showNotification('Info', 'Refreshing process list...', 'info');
        
        // TODO: Implement actual process refresh
        setTimeout(() => {
            showNotification('Success', 'Process list updated', 'success');
        }, 500);
    }
    
    function clearLogs() {
        if (confirm('Are you sure you want to clear all log entries?')) {
            document.getElementById('logContent').innerHTML = '';
            showNotification('Success', 'Logs cleared', 'success');
        }
    }
    
    function downloadLogs() {
        const logContent = document.getElementById('logContent').innerText;
        const blob = new Blob([logContent], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = `cctv_logs_${new Date().toISOString().slice(0, 10)}.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        showNotification('Success', 'Logs downloaded', 'success');
    }
    
    function exportSystemReport() {
        showNotification('Info', 'Generating system report...', 'info');
        
        // TODO: Generate comprehensive system report
        setTimeout(() => {
            const reportData = {
                timestamp: new Date().toISOString(),
                system: {
                    status: 'Running',
                    uptime: document.getElementById('systemUptime').textContent,
                    cpu: document.getElementById('cpuUsage').textContent + '%',
                    memory: document.getElementById('memoryUsage').textContent + '%',
                    disk: document.getElementById('diskUsage').textContent + '%',
                    temperature: document.getElementById('temperatureValue').textContent
                },
                processes: 'Running normally',
                network: {
                    download: document.getElementById('downloadSpeed').textContent,
                    upload: document.getElementById('uploadSpeed').textContent
                }
            };
            
            const blob = new Blob([JSON.stringify(reportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `system_report_${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Success', 'System report downloaded', 'success');
        }, 2000);
    }
    
    // Cleanup on page unload
    window.addEventListener('beforeunload', function() {
        if (systemStatsInterval) {
            clearInterval(systemStatsInterval);
        }
    });
    
    // WebSocket events for real-time system monitoring
    socket.on('system_stats', function(data) {
        document.getElementById('cpuUsage').textContent = data.cpu;
        document.getElementById('memoryUsage').textContent = data.memory;
        document.getElementById('diskUsage').textContent = data.disk;
        document.getElementById('temperatureValue').textContent = data.temperature + '°C';
        
        if (temperatureGauge) {
            temperatureGauge.draw(parseInt(data.temperature));
        }
    });
    
    socket.on('new_log', function(data) {
        const logContent = document.getElementById('logContent');
        const newEntry = document.createElement('div');
        newEntry.className = 'log-entry';
        newEntry.innerHTML = `
            <span class="text-muted">[${data.timestamp}]</span> 
            <span class="${data.class}">[${data.level}]</span> 
            ${data.message}
        `;
        logContent.appendChild(newEntry);
        logContent.scrollTop = logContent.scrollHeight;
    });
</script>

<style>
    .log-container {
        background-color: #1a1d20;
        border: 1px solid #495057;
    }
    
    .log-entry {
        padding: 2px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .log-entry:last-child {
        border-bottom: none;
    }
    
    .card {
        transition: transform 0.2s ease;
    }
    
    .card:hover {
        transform: translateY(-2px);
    }
    
    .progress {
        height: 8px;
    }
    
    @media (max-width: 768px) {
        .display-6 {
            font-size: 1.5rem;
        }
        
        #performanceChart,
        #networkChart {
            height: 200px !important;
        }
        
        #temperatureGauge {
            width: 150px;
            height: 150px;
        }
    }
</style>
{% endblock %}